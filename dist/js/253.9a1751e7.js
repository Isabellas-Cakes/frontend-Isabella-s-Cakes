"use strict";(self["webpackChunkinterfaz"]=self["webpackChunkinterfaz"]||[]).push([[253],{2281:function(e,l,a){a.d(l,{h:function(){return t}});a(5792);var o=a(8071);const t=(0,o.G)("v-spacer","div","VSpacer")},5421:function(e,l,a){a.r(l),a.d(l,{default:function(){return R}});a(4114),a(8111),a(2489),a(1701),a(8237);var o=a(6768),t=a(4232),d=a(144),u=a(4373),r=a(1714),n=a(5972),i=a(4789),s=a(222),c=a(5939),p=a(857),v=a(6978),_=a(4810),b=a(6832),f=a(8388),k=a(5673),m=a(8959),g=a(8150),F=a(6838),h=a(4629),y=a(1539),W=a(2281),C=a(365),w=a(9293),E=a(8741),L=a(8210),X=a(2034),x=a(4797);const V={key:0,class:"mt-2"},A={key:0},K={key:1,class:"text-error"},P={class:"mt-2"};var Q={__name:"PagosPedidos",setup(e){const l=(0,d.KR)([]),a=(0,d.KR)(null),Q=(0,d.KR)(!1),S=(0,d.KR)(null),R=(0,d.KR)(!1),M=(0,d.KR)(localStorage.getItem("rol")),$=(0,r.io)("http://localhost:8080");function I(){localStorage.clear(),window.location.href="/"}const z=async e=>{try{const{data:l}=await u.A.get(`http://localhost:8080/api/detallepedido/pedido/${e.id_pedido}`);a.value={...e,detalles:l.map(e=>({...e,nombre:e.nombre||e.articulo?.nombre||"Artículo",subtotal:parseFloat(e.subtotal)}))},S.value=null,Q.value=!0}catch(l){console.error("Error al cargar detalles:",l),alert("Error al cargar detalles del pedido")}},D=e=>e&&e.detalles?e.detalles.reduce((e,l)=>e+parseFloat(l.subtotal),0):0,T=(0,o.EW)(()=>a.value&&null!=S.value?S.value-D(a.value):0),U=async()=>{a.value&&(null==S.value||T.value<0?alert("Monto insuficiente"):(R.value=!0,await j(a.value)))},j=async e=>{try{await u.A.put(`http://localhost:8080/api/pedidos/${e.id_pedido}/pagar`,{metodo_pago:"efectivo"}),l.value=l.value.filter(l=>l.id_pedido!==e.id_pedido),Q.value=!1,alert("✅ Pedido pagado y mesa liberada")}catch(a){console.error("Error al pagar pedido:",a),alert("No se pudo procesar el pago")}finally{R.value=!1}},B=async()=>{try{const{data:e}=await u.A.get("http://localhost:8080/api/pedidos"),a=e.filter(e=>"servido"===e.estado);for(const l of a){const{data:e}=await u.A.get(`http://localhost:8080/api/detallepedido/pedido/${l.id_pedido}`);l.detalles=e.map(e=>({...e,nombre:e.nombre||e.articulo?.nombre||"Artículo",subtotal:parseFloat(e.subtotal)}))}l.value=a}catch(e){console.error("Error al cargar pedidos:",e)}};return(0,o.sV)(()=>{B(),$.on("estado-pedido-actualizado",async e=>{if("servido"===e.estado){const{data:a}=await u.A.get(`http://localhost:8080/api/detallepedido/pedido/${e.id_pedido}`);e.detalles=a.map(e=>({...e,nombre:e.nombre||e.articulo?.nombre||"Artículo",subtotal:parseFloat(e.subtotal)})),l.value.push(e)}else"pagado"===e.estado&&(l.value=l.value.filter(l=>l.id_pedido!==e.id_pedido))})}),(e,d)=>((0,o.uX)(),(0,o.Wv)(F.I,null,{default:(0,o.k6)(()=>[(0,o.bF)(h.L,{class:"align-center justify-space-between mb-4"},{default:(0,o.k6)(()=>[(0,o.bF)(y.B,{cols:"auto"},{default:(0,o.k6)(()=>d[2]||(d[2]=[(0,o.Lk)("h2",{class:"mb-0"},"💳 Pedidos pendientes de pago",-1)])),_:1,__:[2]}),"cajero"===M.value?((0,o.uX)(),(0,o.Wv)(y.B,{key:0,cols:"auto"},{default:(0,o.k6)(()=>[(0,o.bF)(i.D,{color:"black",variant:"outlined",onClick:I},{default:(0,o.k6)(()=>[(0,o.bF)(C.w,{left:""},{default:(0,o.k6)(()=>d[3]||(d[3]=[(0,o.eW)("mdi-logout",-1)])),_:1,__:[3]}),d[4]||(d[4]=(0,o.eW)(" Cerrar sesión ",-1))]),_:1,__:[4]})]),_:1})):(0,o.Q3)("",!0)]),_:1}),0===l.value.length?((0,o.uX)(),(0,o.Wv)(n.l,{key:0,type:"info",border:"start","colored-border":""},{default:(0,o.k6)(()=>d[5]||(d[5]=[(0,o.eW)(" No hay pedidos listos para pagar. ",-1)])),_:1,__:[5]})):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.value,e=>((0,o.uX)(),(0,o.Wv)(s.J,{key:e.id_pedido,class:"mb-4",outlined:""},{default:(0,o.k6)(()=>[(0,o.bF)(c.r,null,{default:(0,o.k6)(()=>[(0,o.eW)(" 🧾 Pedido #"+(0,t.v_)(e.id_pedido)+" — Mesa "+(0,t.v_)(e.id_mesa),1)]),_:2},1024),(0,o.bF)(p.Z,null,{default:(0,o.k6)(()=>[(0,o.Lk)("div",null,[d[6]||(d[6]=(0,o.Lk)("strong",null,"Mesa:",-1)),(0,o.eW)(" "+(0,t.v_)(e.mesa?.numero||e.id_mesa),1)]),(0,o.Lk)("div",null,[d[7]||(d[7]=(0,o.Lk)("strong",null,"Cliente:",-1)),(0,o.eW)(" "+(0,t.v_)(e.nombre||"Sin nombre"),1)]),(0,o.Lk)("div",null,[d[8]||(d[8]=(0,o.Lk)("strong",null,"Total:",-1)),(0,o.eW)(" Q"+(0,t.v_)(D(e).toFixed(2)),1)])]),_:2},1024),(0,o.bF)(v.S,null,{default:(0,o.k6)(()=>[(0,o.bF)(i.D,{color:"primary",onClick:l=>z(e)},{default:(0,o.k6)(()=>d[9]||(d[9]=[(0,o.eW)(" 💵 Pagar ",-1)])),_:2,__:[9]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),(0,o.bF)(b.p,{modelValue:Q.value,"onUpdate:modelValue":d[1]||(d[1]=e=>Q.value=e),"max-width":"600px"},{default:(0,o.k6)(()=>[(0,o.bF)(s.J,null,{default:(0,o.k6)(()=>[(0,o.bF)(c.r,null,{default:(0,o.k6)(()=>[(0,o.eW)(" Confirmar pago — Pedido #"+(0,t.v_)(a.value?.id_pedido),1)]),_:1}),a.value?((0,o.uX)(),(0,o.Wv)(_.O,{key:0},{default:(0,o.k6)(()=>[(0,o.bF)(x.W,{modelValue:S.value,"onUpdate:modelValue":d[0]||(d[0]=e=>S.value=e),modelModifiers:{number:!0},label:"💵 Efectivo recibido",type:"number",min:"0",class:"mt-2","prepend-inner-icon":"mdi-cash"},null,8,["modelValue"]),null!==S.value?((0,o.uX)(),(0,o.CE)("p",V,[d[10]||(d[10]=(0,o.Lk)("strong",null,"Cambio:",-1)),T.value>=0?((0,o.uX)(),(0,o.CE)("span",A,"Q"+(0,t.v_)(T.value.toFixed(2)),1)):((0,o.uX)(),(0,o.CE)("span",K,"❌ Efectivo insuficiente"))])):(0,o.Q3)("",!0),(0,o.bF)(f.$,{class:"mt-4"},{default:(0,o.k6)(()=>[(0,o.bF)(k.c,null,{default:(0,o.k6)(()=>[(0,o.bF)(m.w,null,{default:(0,o.k6)(()=>d[11]||(d[11]=[(0,o.eW)("🧾 Ver resumen de pago",-1)])),_:1,__:[11]}),(0,o.bF)(g.T,null,{default:(0,o.k6)(()=>[(0,o.bF)(w.x8,{density:"compact"},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.value?.detalles||[],e=>((0,o.uX)(),(0,o.Wv)(E.g,{key:e.id_detalle},{default:(0,o.k6)(()=>[(0,o.bF)(L.U,null,{default:(0,o.k6)(()=>[(0,o.eW)((0,t.v_)(e.cantidad)+" x "+(0,t.v_)(e.nombre),1)]),_:2},1024),(0,o.bF)(X.w,null,{default:(0,o.k6)(()=>[(0,o.eW)(" Subtotal: Q"+(0,t.v_)(e.subtotal.toFixed(2)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),(0,o.Lk)("p",P,[d[12]||(d[12]=(0,o.Lk)("strong",null,"Total:",-1)),(0,o.eW)(" Q"+(0,t.v_)(D(a.value).toFixed(2)),1)]),d[13]||(d[13]=(0,o.Lk)("p",null,[(0,o.Lk)("strong",null,"Método de pago:"),(0,o.eW)(" 💵 Efectivo")],-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):(0,o.Q3)("",!0),(0,o.bF)(v.S,null,{default:(0,o.k6)(()=>[(0,o.bF)(W.h),(0,o.bF)(i.D,{color:"success",disabled:R.value,onClick:U},{default:(0,o.k6)(()=>[(0,o.eW)((0,t.v_)(R.value?"Procesando...":"Confirmar pago"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};const S=Q;var R=S}}]);
//# sourceMappingURL=253.9a1751e7.js.map